<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Form Kasir Santri</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f0f2f5;
      margin: 0;
      padding: 0;
    }

    .judul-box {
      font-size: 36px;
      font-weight: bold;
      margin-bottom: 16px;
      text-align: center;
      color: #333;
      margin-bottom: 4px;
    }

.form-group input:focus {
  outline: none;
  background-color: #e3f2fd;         /* ‚¨ÖÔ∏è biru pudar */
  color: #0d6efd;                    /* ‚¨ÖÔ∏è biru terang */
  font-weight: bold;                /* ‚¨ÖÔ∏è teks tebal */
  border: 2px solid #0d6efd;        /* ‚¨ÖÔ∏è garis biru terang */
  box-shadow: 0 0 0 2px rgba(13, 110, 253, 0.3); /* ‚¨ÖÔ∏è glow biru */
  transition: all 0.2s ease;
}

textarea:focus,
select:focus {
  background-color: #e3f2fd;
  color: #0d6efd;
  font-weight: bold;
  border: 2px solid #0d6efd;
  box-shadow: 0 0 0 2px rgba(13, 110, 253, 0.3);
  transition: all 0.2s ease;
}

.judul-container {
  position: fixed; /* ‚¨ÖÔ∏è Tetap di posisi atas layar */
  top: 0;           /* ‚¨ÖÔ∏è Menempel di bagian atas */
  left: 0;
  right: 0;
  z-index: 999;     /* ‚¨ÖÔ∏è Pastikan tampil di atas elemen lain */
  
  background: linear-gradient(to right, #2e7d32, #a5d6a7);
  padding: 4px 0;   /* ‚¨ÖÔ∏è Padding atas saja */
  margin: 0 auto;
  width: 100%;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  color: white;
  text-align: center;
  border-radius: 0;
}

.judul-flex {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px; /* ‚¨ÖÔ∏è jarak antara logo dan teks */
}

.logo-kepang {
  width: 48px;
  height: 48px;
  object-fit: contain;
  margin-right: -4px;
  align-self: flex-end; /* ‚¨ÖÔ∏è sejajarkan ke bawah baris */
}

    .btn-mulai {
      background-color: #28a745;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-bottom: 24px;
      margin-top: 120px;
    }
    .btn-mulai:hover {
      background-color: #218838;
    }

    .overlay-transaksi {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      backdrop-filter: blur(6px);
      background-color: rgba(0, 0, 0, 0.3);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 999;
    }

.subjudul-wrapper {
  text-align: center; /* ‚¨ÖÔ∏è pastikan kontennya rata tengah */
  margin-top: 8px;
}

.subjudul-ramping {
  font-size: 15px;
  font-weight: 500;
  color: white;
  margin-top: -12px; /* ‚¨ÖÔ∏è lebih rapat lagi */
  line-height: 1.2;   /* ‚¨ÖÔ∏è padatkan jarak antar baris */
  text-align: center;
}

.transaksi-box {
  position: relative;
  background: linear-gradient(to left, #2e7d32, #a5d6a7);
  padding: 32px;
  box-shadow:
    0 8px 16px rgba(0,0,0,0.25),   /* bayangan bawah dalam */
    0 0 0 2px rgba(255,255,255,0.1), /* garis tepi terang */
    inset 0 1px 2px rgba(255,255,255,0.2); /* efek cahaya dalam */
  width: 100%;
  max-width: 960px;
  margin: auto;
  color: white;
  border-radius: 16px;
  transition: box-shadow 0.3s ease;
}

.judul-transaksi {
  font-size: 32px;
  font-weight: bold;
  margin-top: 4px;         /* ‚¨ÖÔ∏è jarak atas dipersempit */
  margin-bottom: 20px;
  text-align: center;
  color: white;
  text-shadow: 0 1px 2px rgba(0,0,0,0.3);
  letter-spacing: 1px;
}

.btn-tutup {
  position: absolute;
  top: 16px;
  right: 16px;
  background-color: transparent;
  border: none;
  font-size: 20px;
  cursor: pointer;
  color: white;
}
    .btn-tutup:hover {
      background-color: #c82333;
    }

    .box-no-id,
    .box-form-horizontal,
    .box-form-horizontal.kedua {
      background-color: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .form-group {
      margin-bottom: 12px;
    }

    .form-group label {
      font-weight: bold;
      margin-bottom: 6px;
      font-size: 14px;
      color: #333;
      display: block;
    }

    .form-group input {
      padding: 10px 12px;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 14px;
      width: 100%;
      box-sizing: border-box;
    }

    .btn-simpan {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      width: 100%;
    }

.btn-simpan:focus {
  background-color: #ff5722;
  outline: none;
  box-shadow: none;
}
    .btn-simpan:hover {
      background-color: #ff5722;
    }

    .gambar-area {
      width: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 16px;
    }

    .gambar-penuh {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      border-radius: 8px;
    }

    .aksi-horizontal {
      display: flex;
      justify-content: center;
      gap: 12px;
      flex-wrap: wrap;
    }

.btn-aksi {
  padding: 10px 16px;
  font-size: 16px;
  font-weight: bold;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  min-width: 140px;
  transition: background-color 0.2s ease, box-shadow 0.2s ease;
  box-shadow: 0 2px 6px rgba(0,0,0,0.15); /* ‚¨ÖÔ∏è bayangan awal */
}

/* Tombol Edit */
.btn-aksi.edit {
  background-color: #28a745;
  color: white;
}
.btn-aksi.edit:hover {
  background-color: #218838; /* ‚¨ÖÔ∏è versi lebih gelap */
  box-shadow: 0 4px 10px rgba(0,0,0,0.2); /* ‚¨ÖÔ∏è efek 3D saat hover */
}

/* Tombol Input Saldo */
.btn-aksi.input-saldo {
  background-color: #ffc107;
  color: #333;
}
.btn-aksi.input-saldo:hover {
  background-color: #e0a800;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}

/* Tombol Cetak Kartu */
.btn-aksi.cetak-kartu {
  background-color: #17a2b8;
  color: white;
}
.btn-aksi.cetak-kartu:hover {
  background-color: #138496;
  box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}

.grid-3-kolom {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
  gap: 24px;
  width: 100%;
  max-width: 900px;
  margin: 0 auto;
}

.kolom {
  background-color: #fff;
  padding: 20px;
  border-radius: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.1);
}

.foto-box {
  width: 100%;
  max-width: 160px;
  height: 160px;
  margin: 0 auto 16px;
  border: 2px dashed #aaa;
  border-radius: 8px;
  background-color: #fefefe;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
}

.foto-box img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 8px;
}

.table-wrapper {
  width: 100%;
  max-height: 400px;
  overflow: auto;
  border: 1px solid #ccc;
  border-radius: 8px;
  margin-top: 10px;
  margin-bottom: 24px;
}

#tabel-transaksi {
  width: 100%;
  border-collapse: collapse;
  font-size: 13px;
  table-layout: fixed; /* ‚¨ÖÔ∏è penting agar kolom tidak melebar */
}

#tabel-transaksi th,
#tabel-transaksi td {
  padding: 6px 10px;
  border-bottom: 1px solid #ddd;
  text-align: left;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis; /* ‚¨ÖÔ∏è potong teks panjang */
}

#tabel-transaksi thead {
  position: sticky;
  top: 0;
  background-color: #e8f5e9;
  z-index: 1;
}

#tabel-transaksi tbody tr:nth-child(even) {
  background-color: #f9f9f9;
}

#tabel-transaksi tbody tr:hover {
  background-color: #e6f7ff;
}

#jumlah-kiriman {
  font-size: 18px;              /* ‚¨ÖÔ∏è lebih besar */
  font-weight: 600;             /* ‚¨ÖÔ∏è agak tebal */
  color: #ffc107;               /* ‚¨ÖÔ∏è kuning terang */
  background-color: #fffde7;    /* ‚¨ÖÔ∏è latar kuning pudar */
  border: 2px solid #ffc107;
}

#saldo-terbaru {
  font-size: 18px;
  font-weight: 600;
  color: #28a745;               /* ‚¨ÖÔ∏è hijau terang */
  background-color: #e8f5e9;    /* ‚¨ÖÔ∏è latar hijau pudar */
  border: 2px solid #28a745;
}

  </style>
</head>
<body>

<div class="judul-container">
  <div class="judul-flex">
    <img src="https://brnqpdvtninzyqqwhmfj.supabase.co/storage/v1/object/public/fotoku12/LAMBANG.jpg" alt="Logo Kepang" class="logo-kepang">
    <div>
      <h3 class="judul-box">KAUNTRI</h3>
      <div class="subjudul-ramping">Kartu Keuangan Santri</div>
    </div>
  </div>
</div>

<div style="text-align:center;">
    <button id="btn-mulai" class="btn-mulai">üü¢ MULAI TRANSAKSI</button>
  </div>

  <!-- üî∑ Box Gambar Tetap Tampil -->
  <div class="box-no-id kedua gambar-saja">
    <div class="gambar-area">
      <img src="https://tse4.mm.bing.net/th/id/OIP.Byp3baV39njGXGW04hOyNQHaE4?pid=Api&P=0&h=180" alt="Icon Transaksi" class="gambar-penuh">
    </div>
    <div class="aksi-horizontal">
      <button class="btn-aksi edit" onclick="window.location.href='TRANSAKSIMASSAL.html'">üí∏ Transaksi massal</button>
      <button class="btn-aksi input-saldo" onclick="window.location.href='https://skretaris1919-cloud.github.io/KAUNTRI/SALDO.HTML'">üí∞ Input Saldo</button>
      <button class="btn-aksi cetak-kartu" onclick="window.location.href='KARTU.html'">üìÑ Cetak Kartu</button>
    </div>
  </div>

<!-- üî∂ Overlay Transaksi -->
<div id="transaksi-overlay" class="overlay-transaksi">
  <div class="transaksi-box">
    <button class="btn-tutup" onclick="document.getElementById('transaksi-overlay').style.display='none'">‚ùå Tutup</button>
    <h3 class="judul-transaksi">TRANSAKSI SANTRI</h3>
    <div class="grid-3-kolom">
      <!-- Kolom 1: Form Transaksi + Foto -->
      <div class="kolom">
        <div class="foto-box">
          <img id="preview-foto" src="" alt="Foto Santri">
        </div>

        <div class="form-group"><label for="no-id">No ID Santri</label><input type="text" id="no-id"></div>
        <div class="form-group"><label for="nama">Nama</label><input type="text" id="nama"></div>
        <div class="form-group"><label for="nominal">Nominal</label><input type="text" id="nominal"></div>
        <div class="form-group"><button id="btn-simpan" class="btn-simpan">TRANSAKSI</button></div>
      </div>

      <!-- Kolom 2: Rincian 1 -->
      <div class="kolom">
        <div class="form-group"><label for="kamar">Nama Kamar</label><input type="text" id="kamar"></div>
        <div class="form-group"><label for="alamat">Alamat</label><input type="text" id="alamat"></div>
        <div class="form-group"><label for="jumlah">Saldo Kiriman</label><input type="text" id="jumlah"></div>
        <div class="form-group"><label for="saldo-awal">Saldo Tabungan</label><input type="text" id="saldo-awal"></div>
        <div class="form-group"><label for="saldo-akhir">Saldo Akhir</label><input type="text" id="saldo-akhir" readonly></div>
      </div>

      <!-- Kolom 3: Rincian 2 -->
      <div class="kolom">
        <div class="form-group"><label for="limit-harian">Limit Harian</label><input type="text" id="limit-harian"></div>
        <div class="form-group"><label for="total-hari-ini">Total Hari Ini</label><input type="text" id="total-hari-ini"></div>
        <div class="form-group"><label for="makan">Makan</label><input type="text" id="makan"></div>
        <div class="form-group"><label for="jumlah-kiriman">Sisa Kiriman</label><input type="text" id="jumlah-kiriman" readonly></div>
        <div class="form-group"><label for="saldo-terbaru">Saldo Terbaru</label><input type="text" id="saldo-terbaru" readonly></div>
      </div>
    </div>
  </div>
</div>

<div class="table-wrapper">
  <table id="tabel-transaksi">
    <thead>
      <tr>
        <th>No ID</th>
        <th>Nama</th>
        <th>Kamar</th>
        <th>Alamat</th>
        <th>Jumlah</th>
        <th>Nominal</th>
        <th>Saldo Awal</th>
        <th>Saldo Akhir</th>
        <th>Limit Harian</th>
        <th>Makan</th>
        <th>Jumlah Kiriman</th>
        <th>Saldo Terbaru</th>
        <th>Waktu</th>
        <th>Created By</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>


<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

  const supabaseUrl = 'https://brnqpdvtninzyqqwhmfj.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJybnFwZHZ0bmluenlxcXdobWZqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1NjU3OTQsImV4cCI6MjA3MzE0MTc5NH0.6u2P5ANnDV1237hEY73M0OHRDftwc3-G0JbRx44YcZc'; // üîí pastikan aman
  const supabase = createClient(supabaseUrl, supabaseKey);


document.addEventListener('DOMContentLoaded', function() {
  document.getElementById('btn-mulai').addEventListener('click', function() {
    document.querySelector('.overlay-transaksi').style.display = 'flex';

    // ‚¨áÔ∏è Fokus input setelah overlay muncul
    setTimeout(() => {
      const inputID = document.getElementById('no-id');
      if (inputID) {
        inputID.focus();
        inputID.select();
      }
    }, 100);
  });
});

  // üî¢ Format visual Rp
function formatRupiah(angka) {
  if (angka === '' || angka === null || angka === undefined) return '';
  const num = parseFloat(angka.toString().replace(/[^\d\-]/g, '')); // üîß pertahankan minus
  if (isNaN(num)) return '';
  const isNegative = num < 0;
  const formatted = Math.abs(num).toLocaleString('id-ID');
  return (isNegative ? '-Rp ' : 'Rp ') + formatted;
}

  // üî¢ Ambil angka asli dari Rp
  function unformatRupiah(rpString) {
    return parseFloat(rpString.replace(/[^\d]/g, '')) || 0;
  }

  // üîÅ Kalkulasi otomatis
function updateKalkulasi() {
  const nominalInput = document.getElementById('nominal');
  const jumlahInput = document.getElementById('jumlah');
  const saldoAwalInput = document.getElementById('saldo-awal');
  const jumlahKirimanInput = document.getElementById('jumlah-kiriman');
  const saldoTerbaruInput = document.getElementById('saldo-terbaru');

  const nominal = unformatRupiah(nominalInput.value);
  const jumlah = unformatRupiah(jumlahInput.value);
  const saldoAwal = unformatRupiah(saldoAwalInput.value);

  const kiriman = jumlah - nominal;
  const saldoTerbaru = saldoAwal + kiriman;

  // üî¥ Validasi jika kiriman negatif
  if (kiriman < 0) {
    alert('Saldo kiriman Anda tidak mencukupi, silakan isi ulang.');
    nominalInput.value = '';
    jumlahKirimanInput.value = '';
    saldoTerbaruInput.value = '';
    jumlahKirimanInput.classList.remove('negatif');
    nominalInput.focus();
    return;
  }

  // ‚úÖ Tampilkan hasil kalkulasi
  jumlahKirimanInput.value = formatRupiah(kiriman);
  saldoTerbaruInput.value = formatRupiah(saldoTerbaru);

  // üî¥ Tambahkan warna merah jika minus (opsional, redundant di sini)
  if (kiriman < 0) {
    jumlahKirimanInput.classList.add('negatif');
  } else {
    jumlahKirimanInput.classList.remove('negatif');
  }
}

 // üîé Hitung total transaksi hari ini berdasarkan no_id
async function hitungTotalHariIni(noId) {
  const hariIni = new Date().toISOString().slice(0, 10); // Format: '2025-09-19'

  const { data, error } = await supabase
    .from('tb_transaksi')
    .select('nominal, waktu, no_id')
    .eq('no_id', noId)
    .gte('waktu', `${hariIni}T00:00:00`)
    .lte('waktu', `${hariIni}T23:59:59`);

  if (error) {
    console.error('Gagal ambil data nominal hari ini:', error.message);
    return;
  }

  let total = 0;
  data.forEach(row => {
    if (row.nominal) {
      total += unformatRupiah(row.nominal); // ubah 'Rp 5.000' jadi 5000
    }
  });

  const inputTotal = document.getElementById('total-hari-ini');
  if (inputTotal) {
    inputTotal.value = formatRupiah(total); // tampilkan sebagai 'Rp 24.000'
  }

  console.log(`Total nominal hari ini untuk ${noId}:`, total);
}

 // üßæ Load tabel transaksi
async function loadTransaksiTable() {
  const { data, error } = await supabase
    .from('tb_transaksi')
    .select('no_id, nama, nama_kamar, alamat, jumlah, nominal, saldo_tabungan, saldo_akhir, limit_harian, makan, jumlah_kiriman, waktu, created_by')
    .order('waktu', { ascending: false });

  console.log('Data transaksi:', data);
  data.forEach((row, i) => {
    console.log(`Baris ${i}: nominal =`, row.nominal);
  });

  if (error) {
    console.error('Gagal ambil data:', error.message);
    return;
  }

  const tbody = document.querySelector('#tabel-transaksi tbody');
  if (!tbody) {
    console.error('Elemen <tbody> tidak ditemukan. Pastikan struktur HTML benar.');
    return;
  }

  tbody.innerHTML = '';

  data.forEach(row => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${row.no_id}</td>
      <td>${row.nama}</td>
      <td>${row.nama_kamar}</td>
      <td>${row.alamat}</td>
      <td>${formatRupiah(row.jumlah)}</td>
      <td>${row.nominal}</td>
      <td>${formatRupiah(row.saldo_tabungan)}</td>
      <td>${formatRupiah(row.saldo_akhir)}</td>
      <td>${formatRupiah(row.limit_harian)}</td>
      <td>${formatRupiah(row.makan)}</td>
      <td>${formatRupiah(row.jumlah_kiriman)}</td>
      <td>${formatRupiah(unformatRupiah(row.saldo_tabungan) + unformatRupiah(row.jumlah_kiriman))}</td>
      <td>${new Date(row.waktu).toLocaleString()}</td>
      <td>${row.created_by}</td>
    `;
    tbody.appendChild(tr);
  });
}

  // üöÄ Inisialisasi saat halaman siap
  document.addEventListener('DOMContentLoaded', () => {
    loadTransaksiTable();

    const noIdInput = document.getElementById('no-id');
    const fotoPreview = document.getElementById('preview-foto');

    noIdInput.addEventListener('input', async () => {
      const noId = noIdInput.value.trim();
      if (!noId || noId.length < 3) return;

      const fields = [
        'nama', 'kamar', 'alamat', 'jumlah',
        'saldo-awal', 'saldo-akhir', 'limit-harian',
        'makan', 'jumlah-kiriman', 'saldo-terbaru', 'total-hari-ini'
      ];
      fields.forEach(id => {
        const el = document.getElementById(id);
        if (el) el.value = '';
      });
      if (fotoPreview) fotoPreview.src = '';

      const { data, error } = await supabase
        .from('tb_saldo')
        .select('*')
        .eq('no_id', noId)
        .order('waktu', { ascending: false })
        .limit(1);

      if (error || !data || data.length === 0) {
        console.warn('Data tidak ditemukan:', error?.message);
        return;
      }

      const d = data[0];
      document.getElementById('nama').value = d.nama || '';
      document.getElementById('kamar').value = d.nama_kamar || '';
      document.getElementById('alamat').value = d.alamat || '';
      document.getElementById('jumlah').value = formatRupiah(d.jumlah_kiriman || 0);
      document.getElementById('saldo-awal').value = formatRupiah(d.saldo_tabungan || 0);
      updateKalkulasi();
      document.getElementById('saldo-akhir').value = formatRupiah(d.saldo_akhir || 0);
      document.getElementById('limit-harian').value = formatRupiah(d.limit_harian || 0);
      document.getElementById('makan').value = formatRupiah(d.makan || 0);
      document.getElementById('jumlah-kiriman').value = ''; // kosongkan dulu, biar dihitung ulang
      
      const kiriman = unformatRupiah(d.jumlah_kiriman || '0');
      const saldoAwal = unformatRupiah(d.saldo_tabungan || '0');
      document.getElementById('saldo-terbaru').value = formatRupiah(saldoAwal + kiriman);

      if (d.foto_url && fotoPreview) fotoPreview.src = d.foto_url;
      document.getElementById('nominal').focus();

      updateKalkulasi();
      await hitungTotalHariIni(noId);
    });

document.getElementById('nominal').addEventListener('keydown', function (e) {
  if (e.key === 'Enter') {
    e.preventDefault(); // ‚õî cegah submit default
    document.getElementById('btn-simpan').focus(); // üéØ pindah fokus
  }
});

//SIMPAN
document.getElementById('btn-simpan').addEventListener('click', async () => {
  // üîÑ Ambil semua data dari form
  const data = {
    no_id: document.getElementById('no-id').value.trim(),
    nama: document.getElementById('nama').value.trim(),
    nama_kamar: document.getElementById('kamar').value.trim(),
    alamat: document.getElementById('alamat').value.trim(),
    jumlah: unformatRupiah(document.getElementById('jumlah').value.trim()),
    saldo_tabungan: unformatRupiah(document.getElementById('saldo-awal').value.trim()),
    saldo_akhir: unformatRupiah(document.getElementById('saldo-akhir').value.trim()),
    limit_harian: unformatRupiah(document.getElementById('limit-harian').value.trim()),
    makan: document.getElementById('makan').value.trim(),
    jumlah_kiriman: unformatRupiah(document.getElementById('jumlah-kiriman').value.trim()),
    saldo_terbaru: unformatRupiah(document.getElementById('saldo-terbaru').value.trim()),
    nominal: unformatRupiah(document.getElementById('nominal').value.trim()),
    waktu: new Date().toISOString(),
    created_by: 'system'
  };

  // ‚úÖ Validasi minimal
  if (!data.no_id || !data.nominal) {
    alert('No ID dan Nominal wajib diisi.');
    return;
  }

  // ‚úÖ Simpan ke tb_transaksi
  const { error } = await supabase
    .from('tb_transaksi')
    .insert([data]);

  if (error) {
    console.error('Gagal simpan:', error.message);
    alert('Gagal menyimpan data.');
    return;
  }

  alert('Data berhasil disimpan ke tb_transaksi.');

  // ‚úÖ Update tb_saldo berdasarkan no_id
  await supabase
    .from('tb_saldo')
    .update({
      jumlah_kiriman: data.jumlah_kiriman,
      saldo_akhir: data.saldo_terbaru
    })
    .eq('no_id', data.no_id);

  // üîÑ Reset semua input
  document.querySelectorAll('input').forEach(input => {
    input.value = '';
  });

  // üéØ Fokus ke no-id
  document.getElementById('no-id').focus();

  // üîÅ Refresh kalkulasi dan tabel
  updateKalkulasi();
  loadTransaksiTable();
});

    // üí° Format semua input nominal
    const nominalFields = [
      'nominal', 'jumlah', 'saldo-awal', 'saldo-akhir',
      'limit-harian', 'total-hari-ini', 'makan',
      'jumlah-kiriman', 'saldo-terbaru'
    ];

    nominalFields.forEach(id => {
      const input = document.getElementById(id);
      if (!input) return;

      input.addEventListener('input', () => {
        const raw = unformatRupiah(input.value);
        input.value = formatRupiah(raw);
        if (id === 'nominal') updateKalkulasi();
      });
    });
  });
</script>
</body>
</html>






